<div class="raw-material-form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <div class="header-content">
          <button mat-icon-button (click)="cancel()" class="back-button">
            <mat-icon>arrow_back</mat-icon>
          </button>
          <h1>{{ (isEditMode ? 'rawMaterials.edit' : 'rawMaterials.create') | translate }}</h1>
        </div>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="material-form">
        <!-- Basic Information Section -->
        <div class="form-section">
          <h2>Información Básica</h2>
          <div class="form-grid">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'rawMaterials.name' | translate }}</mat-label>
              <input matInput formControlName="name" [placeholder]="'rawMaterials.name' | translate" />
              <mat-error *ngIf="form.get('name')?.hasError('required')">
                {{ getErrorMessage('name') }}
              </mat-error>
              <mat-error *ngIf="form.get('name')?.hasError('maxlength')">
                {{ getErrorMessage('name') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'rawMaterials.description' | translate }}</mat-label>
              <textarea
                matInput
                formControlName="description"
                [placeholder]="'rawMaterials.description' | translate"
                rows="3"
              ></textarea>
              <mat-error *ngIf="form.get('description')?.hasError('maxlength')">
                {{ getErrorMessage('description') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'rawMaterials.brand' | translate }}</mat-label>
              <input matInput formControlName="brand" [placeholder]="'rawMaterials.brand' | translate" />
              <mat-error *ngIf="form.get('brand')?.touched">
                {{ getErrorMessage('brand') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'rawMaterials.supplier' | translate }}</mat-label>
              <input matInput formControlName="supplier" [placeholder]="'rawMaterials.supplier' | translate" />
              <mat-error *ngIf="form.get('supplier')?.touched">
                {{ getErrorMessage('supplier') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'rawMaterials.category' | translate }}</mat-label>
              <mat-select formControlName="categoryId" [placeholder]="'rawMaterials.category' | translate">
                @for (category of categories; track category.id) {
                  <mat-option [value]="category.id">
                    {{ category.name }}
                  </mat-option>
                }
              </mat-select>
              <mat-error *ngIf="form.get('categoryId')?.touched">
                {{ getErrorMessage('categoryId') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Purchase Information Section -->
        <div class="form-section">
          <h2>Información de Compra</h2>
          <div class="form-grid">
            <mat-form-field appearance="outline">
              <mat-label>{{ 'rawMaterials.purchaseUnit' | translate }}</mat-label>
              <mat-select formControlName="purchaseUnitId" [placeholder]="'rawMaterials.purchaseUnit' | translate">
                @for (unit of units; track unit.id) {
                  <mat-option [value]="unit.id">
                    {{ unit.name }} ({{ unit.code }})
                  </mat-option>
                }
              </mat-select>
              <mat-error *ngIf="form.get('purchaseUnitId')?.touched">
                {{ getErrorMessage('purchaseUnitId') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'rawMaterials.purchaseQuantity' | translate }}</mat-label>
              <input
                matInput
                type="number"
                formControlName="purchaseQuantity"
                [placeholder]="'rawMaterials.purchaseQuantity' | translate"
              />
              <mat-error *ngIf="form.get('purchaseQuantity')?.touched">
                {{ getErrorMessage('purchaseQuantity') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'rawMaterials.unitCost' | translate }}</mat-label>
              <input
                matInput
                type="number"
                step="0.01"
                formControlName="unitCost"
                [placeholder]="'rawMaterials.unitCost' | translate"
              />
              <span matPrefix>$&nbsp;</span>
              <mat-error *ngIf="form.get('unitCost')?.touched">
                {{ getErrorMessage('unitCost') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'rawMaterials.currency' | translate }}</mat-label>
              <input matInput formControlName="currency" [placeholder]="'rawMaterials.currency' | translate" />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'rawMaterials.minimumStock' | translate }}</mat-label>
              <input
                matInput
                type="number"
                formControlName="minimumStock"
                [placeholder]="'rawMaterials.minimumStock' | translate"
              />
              <mat-error *ngIf="form.get('minimumStock')?.touched">
                {{ getErrorMessage('minimumStock') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Allergens Section -->
        <div class="form-section">
          <h2>{{ 'rawMaterials.allergens' | translate }}</h2>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'rawMaterials.allergens' | translate }}</mat-label>
            <mat-select formControlName="allergenIds" multiple>
              @for (allergen of allergens; track allergen.id) {
                <mat-option [value]="allergen.id">
                  {{ allergen.name }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button mat-button type="button" (click)="cancel()" [disabled]="loading">
            {{ 'common.cancel' | translate }}
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading || form.invalid">
            <mat-spinner *ngIf="loading" diameter="20" class="button-spinner"></mat-spinner>
            <span *ngIf="!loading">
              {{ 'common.save' | translate }}
            </span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
