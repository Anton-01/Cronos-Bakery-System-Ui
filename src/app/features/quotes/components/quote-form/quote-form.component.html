<div class="quote-form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <div class="header-content">
          <button mat-icon-button (click)="cancel()" class="back-button">
            <mat-icon>arrow_back</mat-icon>
          </button>
          <h1>{{ (isEditMode ? 'quotes.edit' : 'quotes.create') | translate }}</h1>
        </div>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="quote-form">
        <!-- Client Information Section -->
        <div class="form-section">
          <h2>{{ 'quotes.clientInformation' | translate }}</h2>
          <div class="form-grid">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'quotes.clientName' | translate }}</mat-label>
              <input matInput formControlName="clientName" [placeholder]="'quotes.clientName' | translate" />
              <mat-error *ngIf="form.get('clientName')?.touched">
                {{ getErrorMessage('clientName') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'quotes.clientEmail' | translate }}</mat-label>
              <input matInput type="email" formControlName="clientEmail" [placeholder]="'quotes.clientEmail' | translate" />
              <mat-icon matPrefix>email</mat-icon>
              <mat-error *ngIf="form.get('clientEmail')?.touched">
                {{ getErrorMessage('clientEmail') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'quotes.clientPhone' | translate }}</mat-label>
              <input matInput type="tel" formControlName="clientPhone" [placeholder]="'quotes.clientPhone' | translate" />
              <mat-icon matPrefix>phone</mat-icon>
              <mat-error *ngIf="form.get('clientPhone')?.touched">
                {{ getErrorMessage('clientPhone') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'quotes.clientAddress' | translate }}</mat-label>
              <textarea
                matInput
                formControlName="clientAddress"
                [placeholder]="'quotes.clientAddress' | translate"
                rows="2"
              ></textarea>
              <mat-icon matPrefix>location_on</mat-icon>
              <mat-error *ngIf="form.get('clientAddress')?.touched">
                {{ getErrorMessage('clientAddress') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Quote Configuration Section -->
        <div class="form-section">
          <h2>{{ 'quotes.configuration' | translate }}</h2>
          <div class="form-grid">
            <mat-form-field appearance="outline">
              <mat-label>{{ 'quotes.validityDays' | translate }}</mat-label>
              <input
                matInput
                type="number"
                formControlName="validityDays"
                [placeholder]="'quotes.validityDays' | translate"
              />
              <span matTextSuffix>{{ 'quotes.days' | translate }}</span>
              <mat-error *ngIf="form.get('validityDays')?.touched">
                {{ getErrorMessage('validityDays') }}
              </mat-error>
            </mat-form-field>

            @if (isEditMode) {
              <mat-form-field appearance="outline">
                <mat-label>{{ 'quotes.status' | translate }}</mat-label>
                <mat-select formControlName="status">
                  @for (status of quoteStatuses; track status.value) {
                    <mat-option [value]="status.value">{{ status.label | translate }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            }
          </div>
        </div>

        <!-- Notes Section -->
        <div class="form-section">
          <h2>{{ 'quotes.notes' | translate }}</h2>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'quotes.notesPlaceholder' | translate }}</mat-label>
            <textarea
              matInput
              formControlName="notes"
              [placeholder]="'quotes.notesPlaceholder' | translate"
              rows="6"
            ></textarea>
            <mat-error *ngIf="form.get('notes')?.touched">
              {{ getErrorMessage('notes') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Info Message -->
        <div class="info-message">
          <mat-icon>info</mat-icon>
          <p>{{ 'quotes.itemsInfoMessage' | translate }}</p>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button mat-button type="button" (click)="cancel()" [disabled]="loading">
            {{ 'common.cancel' | translate }}
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading || form.invalid">
            <mat-spinner *ngIf="loading" diameter="20" class="button-spinner"></mat-spinner>
            <span *ngIf="!loading">
              {{ 'common.save' | translate }}
            </span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
